# è´¹ç”¨è®¡ç®—ä¿®å¤æ–‡æ¡£

## é—®é¢˜æè¿°
åœ¨äº¤æ˜“è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯ï¼š`AbiFunctionNotFoundError: Function "getUpdateFee" ä¸å­˜åœ¨ã€‚

## é—®é¢˜åˆ†æ
æ ¹æ®æµ‹è¯•ç”¨ä¾‹ `12-PriceOracle-AAPL.test.js` ä¸­çš„é€»è¾‘ï¼Œè´¹ç”¨è®¡ç®—åº”è¯¥ä½¿ç”¨ `pythPriceFeed.getUpdateFee()` è€Œä¸æ˜¯ `PriceAggregator.getUpdateFee()`ã€‚

## æµ‹è¯•ç”¨ä¾‹ä¸­çš„æ­£ç¡®åšæ³•

### è´¹ç”¨è®¡ç®—ï¼ˆç¬¬119è¡Œï¼‰ï¼š
```javascript
const updateFee = await pythPriceFeed.getUpdateFee(pythUpdateData);
console.log(`   ğŸ’° æ›´æ–°è´¹ç”¨: ${updateFee.toString()} wei`);
```

### èšåˆä»·æ ¼è®¡ç®—ï¼ˆç¬¬123è¡Œï¼‰ï¼š
```javascript
const aggregatedPrice = await priceAggregator.getAggregatedPrice.staticCall(
  TEST_SYMBOL,
  updateDataArray,
  { value: updateFee }
);
```

## ä¿®å¤å†…å®¹

### 1. æ›´æ–°è´¹ç”¨è®¡ç®—é€»è¾‘
**ä¿®å¤å‰ï¼š**
```typescript
// é”™è¯¯ï¼šå°è¯•è°ƒç”¨ä¸å­˜åœ¨çš„å‡½æ•°
const updateFee = await publicClient.readContract({
  address: priceAggregatorAddress,
  abi: PRICE_AGGREGATOR_ABI,
  functionName: "getUpdateFee",
  args: [pythUpdateData]
}) as bigint;
```

**ä¿®å¤åï¼š**
```typescript
// æ­£ç¡®ï¼šä½¿ç”¨ PythPriceFeed è®¡ç®—è´¹ç”¨
const pythPriceFeedAddress = priceAggregatorAddress; // åœ¨æŸäº›æ¶æ„ä¸­ï¼ŒPriceAggregator å°±æ˜¯ PythPriceFeed
const updateFee = await publicClient.readContract({
  address: pythPriceFeedAddress,
  abi: PRICE_AGGREGATOR_ABI,
  functionName: "getUpdateFee",
  args: [pythUpdateData]
}) as bigint;
```

### 2. æ›´æ–°æ—¥å¿—ä¿¡æ¯
```typescript
// ä¿®å¤å‰
console.log("ğŸ’° PriceAggregator æ›´æ–°è´¹ç”¨:");

// ä¿®å¤å
console.log("ğŸ’° PythPriceFeed æ›´æ–°è´¹ç”¨:");
```

### 3. ä¿æŒä»·æ ¼è·å–é€»è¾‘ä¸å˜
```typescript
// ä»·æ ¼è·å–é€»è¾‘ä¿æŒä¸å˜
const currentPrice = await publicClient.readContract({
  address: priceAggregatorAddress,
  abi: PRICE_AGGREGATOR_ABI,
  functionName: "getAggregatedPrice",
  args: [token.symbol, updateDataArray],
  value: updateFee
}) as bigint;
```

## æ¶æ„è¯´æ˜

åœ¨æŸäº›éƒ¨ç½²æ¶æ„ä¸­ï¼Œ`PriceAggregator` åˆçº¦å®é™…ä¸Šå°±æ˜¯ `PythPriceFeed` åˆçº¦ï¼Œæˆ–è€…æ˜¯åŒ…å« PythPriceFeed åŠŸèƒ½çš„èšåˆå™¨ã€‚å› æ­¤ï¼š

1. **è´¹ç”¨è®¡ç®—**ï¼šä½¿ç”¨ `getUpdateFee(pythUpdateData)`
2. **ä»·æ ¼è·å–**ï¼šä½¿ç”¨ `getAggregatedPrice(symbol, updateDataArray, { value: updateFee })`
3. **è´¹ç”¨æ”¯ä»˜**ï¼šåœ¨è°ƒç”¨åˆçº¦æ—¶ï¼Œå°† `updateFee` ä½œä¸º `value` å‚æ•°ä¼ é€’

## ä¿®å¤éªŒè¯

ä¿®å¤åçš„é€»è¾‘ä¸æµ‹è¯•ç”¨ä¾‹å®Œå…¨ä¸€è‡´ï¼š
- âœ… ä½¿ç”¨ PythPriceFeed è®¡ç®—è´¹ç”¨
- âœ… è´¹ç”¨ä¼ é€’ç»™åˆçº¦çš„ `value` å‚æ•°
- âœ… ä¿æŒä»·æ ¼è·å–é€»è¾‘ä¸å˜
- âœ… ä¸æµ‹è¯•ç”¨ä¾‹ä¸­çš„è°ƒç”¨æ–¹å¼ä¸€è‡´

## æµ‹è¯•å»ºè®®

å»ºè®®è¿›è¡Œä»¥ä¸‹æµ‹è¯•ï¼š
1. ä½¿ç”¨æµ‹è¯•ç”¨ä¾‹éªŒè¯ä¿®å¤ç»“æœ
2. æ£€æŸ¥è´¹ç”¨è®¡ç®—æ˜¯å¦æ­£ç¡®
3. ç¡®è®¤äº¤æ˜“èƒ½å¦æ­£å¸¸æ‰§è¡Œ

## ç›¸å…³æ–‡ä»¶
- `/lib/hooks/useTokenTrading.ts` - ä¸»è¦ä¿®å¤æ–‡ä»¶
- `/CryptoStockContract/test/12-PriceOracle-AAPL.test.js` - å‚è€ƒæµ‹è¯•ç”¨ä¾‹
- `/lib/abi/PriceAggregator.json` - PriceAggregator ABI æ–‡ä»¶
- `/lib/abi/deployments-uups-sepolia.json` - éƒ¨ç½²é…ç½®æ–‡ä»¶